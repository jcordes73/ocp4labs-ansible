#
# DHCP Server Configuration file.
#   see /usr/share/doc/dhcp*/dhcpd.conf.example
#   see dhcpd.conf(5) man page
#
option space pxelinux;
option pxelinux.magic code 208 = string;
option pxelinux.configfile code 209 = text;
option pxelinux.pathprefix code 210 = text;
option pxelinux.reboottime code 211 = unsigned integer 32;
option architecture-type code 93 = unsigned integer 16;

subnet 192.168.1.0 netmask 255.255.255.0 {
        option routers                  192.168.1.100;
        option subnet-mask              255.255.255.0;
        option domain-search            "{{ ocp4_cluster_domain_name }}";
        option domain-name-servers      {{ hostvars[groups['bastion'][0]]['ansible_host'] }}, 8.8.8.8;
        option time-offset              3600;     # CET
	range 192.168.1.107 192.168.1.126;
        next-server {{ hostvars[groups['bastion'][0]]['ansible_host'] }};

        class "pxeclients" {
	  match if substring (option vendor-class-identifier, 0, 9) = "PXEClient";
        
          if option architecture-type = 00:07 {
	    filename "uefi/shim.efi";
	  } else {
	    filename "pxelinux/pxelinux.0";
          }
        }
}

{% for host in groups['masters'] %}
host {{ hostvars[host]['inventory_hostname'] }} {
  option host-name "{{ hostvars[host]['inventory_hostname'] }}.{{ocp4_cluster_name}}.{{ocp4_cluster_domain_name}}";
  hardware ethernet {{ hostvars[host]['ethernet'] }};
  fixed-address {{ hostvars[host]['ansible_host'] }};
}

{% endfor %}
{% for host in groups['workers'] %}
host {{ hostvars[host]['inventory_hostname'] }} {
  option host-name "{{ hostvars[host]['inventory_hostname'] }}.{{ocp4_cluster_name}}.{{ocp4_cluster_domain_name}}";
  hardware ethernet {{ hostvars[host]['ethernet'] }};
  fixed-address {{ hostvars[host]['ansible_host'] }};
}

{% endfor %}
